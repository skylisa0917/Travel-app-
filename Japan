<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TabiJourney | 日系極簡行旅</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuedraggable/4.1.0/vuedraggable.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Quicksand:wght@500&display=swap');
        :root { --bg-apricot: #F7F2E9; --muji-beige: #FCF9F5; --soft-brown: #8D7B68; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-apricot); color: #4A4A4A; overflow-x: hidden; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .glass-header { background: rgba(252, 249, 245, 0.85); backdrop-filter: blur(8px); }
        .itinerary-card { transition: transform 0.2s; cursor: grab; }
        .itinerary-card:active { cursor: grabbing; }
        .tab-active { color: var(--soft-brown); border-bottom: 2px solid var(--soft-brown); }
        .date-item.active { background-color: var(--soft-brown); color: white; }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto min-h-screen bg-[#FCF9F5] shadow-xl relative pb-24">
        
        <header class="sticky top-0 z-50 glass-header border-b border-[#EAE3D2]">
            <div class="relative h-48 w-full overflow-hidden">
                <img src="https://images.unsplash.com/photo-1528164344705-47542687990d?auto=format&fit=crop&w=800&q=80" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black/20"></div>
                <div class="absolute bottom-16 left-6 text-white">
                    <h1 class="text-3xl font-light tracking-widest">東京．冬</h1>
                </div>

                <nav class="absolute bottom-2 left-1/2 -translate-x-1/2 flex bg-white/90 backdrop-blur rounded-full px-4 py-2 shadow-lg gap-6">
                    <button @click="currentTab = 'itinerary'" :class="{'text-[#8D7B68]': currentTab === 'itinerary'}" class="flex flex-col items-center">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                    </button>
                    <button @click="currentTab = 'info'" :class="{'text-[#8D7B68]': currentTab === 'info'}" class="flex flex-col items-center">
                        <i data-lucide="info" class="w-5 h-5"></i>
                    </button>
                    <button @click="currentTab = 'shopping'" :class="{'text-[#8D7B68]': currentTab === 'shopping'}" class="flex flex-col items-center">
                        <i data-lucide="shopping-basket" class="w-5 h-5"></i>
                    </button>
                    <button @click="currentTab = 'expenses'" :class="{'text-[#8D7B68]': currentTab === 'expenses'}" class="flex flex-col items-center">
                        <i data-lucide="circle-dollar-sign" class="w-5 h-5"></i>
                    </button>
                </nav>
            </div>

            <div v-if="currentTab === 'itinerary'" class="flex overflow-x-auto hide-scrollbar p-4 gap-4 bg-[#FCF9F5]">
                <div v-for="d in dates" :key="d.date" 
                     @click="selectedDate = d.date"
                     class="date-item flex-shrink-0 flex flex-col items-center justify-center w-12 h-16 rounded-2xl transition-all"
                     :class="selectedDate === d.date ? 'active shadow-md' : 'text-gray-400'">
                    <span class="text-[10px] font-medium uppercase">{{ d.day }}</span>
                    <span class="text-lg font-bold">{{ d.num }}</span>
                </div>
            </div>
        </header>

        <main class="p-4">
            
            <section v-if="currentTab === 'itinerary'">
                <div class="bg-gradient-to-r from-[#EAE3D2] to-[#F7F2E9] rounded-2xl p-4 mb-6 flex justify-between items-center shadow-sm">
                    <div class="flex items-center gap-3">
                        <i data-lucide="cloud-sun" class="w-8 h-8 text-[#8D7B68]"></i>
                        <div>
                            <span class="text-xl font-medium">12°C</span>
                            <p class="text-[10px] text-gray-500">體感 10°C / 東京</p>
                        </div>
                    </div>
                    <span class="text-sm text-[#8D7B68]">多雲轉晴</span>
                </div>

                <draggable v-model="currentDayItinerary" item-key="id" handle=".handle" @end="updateTravelTimes">
                    <template #item="{element, index}">
                        <div>
                            <div v-if="element.type === '航班'" class="bg-[#8D7B68] text-white p-5 rounded-2xl mb-4 shadow-md relative overflow-hidden">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-xs opacity-80">{{ element.flightNo }}</span>
                                    <i data-lucide="plane" class="w-4 h-4"></i>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold">{{ element.origin }}</div>
                                        <div class="text-[10px]">{{ element.time }}</div>
                                    </div>
                                    <div class="flex-1 border-t border-dashed border-white/50 mx-4 relative">
                                        <span class="absolute top-[-10px] left-1/2 -translate-x-1/2 text-[10px] bg-[#8D7B68] px-2">{{ element.duration }}</span>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold">{{ element.dest }}</div>
                                        <div class="text-[10px]">{{ element.arrivalTime }}</div>
                                    </div>
                                </div>
                            </div>

                            <div v-else class="itinerary-card group bg-white p-4 rounded-2xl shadow-sm border border-[#F0EBE3] mb-4 relative">
                                <div class="handle absolute left-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-30">
                                    <i data-lucide="grip-vertical" class="w-4 h-4"></i>
                                </div>
                                <div class="flex justify-between items-start pl-4" @click="startNav(element.address)">
                                    <div>
                                        <div class="flex items-center gap-2">
                                            <span class="px-2 py-0.5 bg-[#F2EDE4] text-[#8D7B68] text-[10px] rounded-md">{{ element.type }}</span>
                                            <span class="text-xs text-gray-400">{{ element.time }}</span>
                                        </div>
                                        <h3 class="text-lg font-medium text-[#5D534A] mt-1">{{ element.name }}</h3>
                                        <div class="text-xs text-gray-400 mt-2 space-y-1">
                                            <p v-if="element.openTime"><i data-lucide="clock" class="inline w-3 h-3 mr-1"></i>{{ element.openTime }}</p>
                                            <p v-if="element.ticket"><i data-lucide="ticket" class="inline w-3 h-3 mr-1"></i>{{ element.ticket }}</p>
                                            <p class="italic text-[#A69080] mt-1">{{ element.note }}</p>
                                        </div>
                                    </div>
                                    <i data-lucide="navigation-2" class="w-5 h-5 text-[#C6A99A]"></i>
                                </div>
                                
                                <div v-if="index < currentDayItinerary.length - 1" class="absolute -bottom-8 left-10 flex items-center gap-2 text-[#A69080]">
                                    <div class="w-0.5 h-4 bg-dashed border-l border-dashed border-[#EAE3D2]"></div>
                                    <i :data-lucide="element.transModeIcon" class="w-3 h-3"></i>
                                    <span class="text-[10px] font-medium">{{ element.nextDist }}</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </draggable>
                
                <button @click="showAddModal = true" class="fixed bottom-28 right-6 w-14 h-14 bg-[#8D7B68] text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition-transform z-50">
                    <i data-lucide="plus" class="w-8 h-8"></i>
                </button>
            </section>

            <section v-if="currentTab === 'info'" class="space-y-6">
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-[#F0EBE3]">
                    <h2 class="text-sm font-medium text-[#8D7B68] mb-4 flex items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> 匯率換算 (當日參考)
                    </h2>
                    <div class="flex items-center gap-4">
                        <div class="flex-1">
                            <label class="text-[10px] text-gray-400">日幣 JPY</label>
                            <input v-model="exJPY" type="number" class="w-full border-b border-[#EAE3D2] py-1 focus:outline-none text-xl bg-transparent">
                        </div>
                        <i data-lucide="arrow-right-left" class="w-4 h-4 text-gray-300 mt-4"></i>
                        <div class="flex-1">
                            <label class="text-[10px] text-gray-400">台幣 TWD</label>
                            <div class="text-xl py-1 font-medium text-[#8D7B68] border-b border-transparent">
                                {{ (exJPY * 0.21).toFixed(0) }}
                            </div>
                        </div>
                    </div>
                </div>

                <div v-for="info in travelInfo" :key="info.title" class="bg-white p-5 rounded-3xl shadow-sm border border-[#F0EBE3]">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-medium">{{ info.title }}</h3>
                        <i :data-lucide="info.icon" class="w-4 h-4 text-[#C6A99A]"></i>
                    </div>
                    <p class="text-sm text-gray-500 leading-relaxed" v-html="info.content"></p>
                    <button v-if="info.address" @click="startNav(info.address)" class="mt-3 text-xs text-[#8D7B68] font-medium flex items-center gap-1">
                        <i data-lucide="map" class="w-3 h-3"></i> 開啟導航
                    </button>
                </div>
            </section>

            <section v-if="currentTab === 'shopping'">
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="item in shoppingList" :key="item.id" class="bg-white rounded-2xl overflow-hidden shadow-sm border border-[#F0EBE3]">
                        <div class="h-32 bg-gray-100 relative">
                            <img :src="item.img" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3">
                            <h4 class="text-sm font-medium">{{ item.name }}</h4>
                            <p class="text-[10px] text-gray-400 mt-1">預計購買: {{ item.price }}</p>
                        </div>
                    </div>
                </div>
                <button class="fixed bottom-28 right-6 w-14 h-14 bg-[#8D7B68] text-white rounded-full shadow-2xl flex items-center justify-center"><i data-lucide="plus" class="w-8 h-8"></i></button>
            </section>

            <section v-if="currentTab === 'expenses'">
                <div class="bg-[#8D7B68] rounded-3xl p-6 text-white mb-6 shadow-lg">
                    <p class="text-xs opacity-70 mb-1 font-light tracking-widest">TOTAL EXPENSES</p>
                    <h2 class="text-3xl font-bold">¥ {{ totalExpenses.toLocaleString() }}</h2>
                    <p class="text-[10px] mt-2 opacity-50 text-right">約 TWD {{ (totalExpenses * 0.21).toLocaleString() }}</p>
                </div>
                
                <div class="space-y-3">
                    <div v-for="exp in expenses" :key="exp.id" class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-[#F0EBE3]">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-[#F7F2E9] flex items-center justify-center">
                                <i :data-lucide="getExpIcon(exp.category)" class="w-5 h-5 text-[#8D7B68]"></i>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium">{{ exp.name }}</h4>
                                <p class="text-[10px] text-gray-400">{{ exp.date }} · {{ exp.payment }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold text-[#5D534A]">¥ {{ exp.amount }}</div>
                            <p class="text-[10px] text-gray-300">{{ exp.category }}</p>
                        </div>
                    </div>
                </div>
                <button class="fixed bottom-28 right-6 w-14 h-14 bg-[#8D7B68] text-white rounded-full shadow-2xl flex items-center justify-center"><i data-lucide="plus" class="w-8 h-8"></i></button>
            </section>

        </main>

        <div v-if="showAddModal" class="fixed inset-0 z-[100] bg-black/40 backdrop-blur-sm flex items-end">
            <div class="bg-white w-full rounded-t-[40px] p-8 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-medium">新增行程</h2>
                    <button @click="showAddModal = false"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div class="space-y-4">
                    <select v-model="newItem.type" class="w-full bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none">
                        <option>景點</option><option>住宿</option><option>美食</option><option>購物</option><option>航班</option>
                    </select>
                    <input v-model="newItem.name" placeholder="行程名稱" class="w-full bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none">
                    <input v-model="newItem.address" placeholder="地址 (用於導航)" class="w-full bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none">
                    <div class="grid grid-cols-2 gap-4">
                        <input v-model="newItem.time" placeholder="時間" class="bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none">
                        <input v-model="newItem.openTime" placeholder="營業時間" class="bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none">
                    </div>
                    <textarea v-model="newItem.note" placeholder="備註內容..." class="w-full bg-[#F7F2E9] rounded-xl px-4 py-3 outline-none h-24"></textarea>
                    
                    <div class="flex gap-4 pt-4">
                        <button v-if="isEditing" @click="confirmDelete" class="flex-1 py-4 rounded-2xl bg-red-50 text-red-500 font-medium">刪除</button>
                        <button @click="saveItem" class="flex-[2] py-4 rounded-2xl bg-[#8D7B68] text-white font-medium shadow-lg">儲存行程</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, computed, watchEffect } = Vue;

        createApp({
            components: {
                draggable: window.vuedraggable
            },
            setup() {
                const currentTab = ref('itinerary');
                const selectedDate = ref('2026-02-15');
                const exJPY = ref(1000);
                const showAddModal = ref(false);
                const isEditing = ref(false);

                // 日期選單資料
                const dates = [
                    { day: 'Fri', num: '15', date: '2026-02-15' },
                    { day: 'Sat', num: '16', date: '2026-02-16' },
                    { day: 'Sun', num: '17', date: '2026-02-17' },
                    { day: 'Mon', num: '18', date: '2026-02-18' },
                    { day: 'Tue', num: '19', date: '2026-02-19' },
                ];

                // 行程資料
                const itineraryData = ref([
                    { id: 1, date: '2026-02-15', type: '航班', flightNo: 'JX800', origin: 'TPE', dest: 'NRT', time: '08:30', arrivalTime: '12:45', duration: '3h 15m' },
                    { id: 2, date: '2026-02-15', type: '住宿', name: '星野集團 界 長門', address: 'Tokyo, Shinjuku', time: '15:00', openTime: 'Check-in 15:00', note: '預計先寄放行李', transModeIcon: 'bus', nextDist: '25 min' },
                    { id: 3, date: '2026-02-15', type: '美食', name: '阿夫利 拉麵', address: 'Shinjuku City, Tokyo', time: '18:00', openTime: '11:00-23:00', note: '必點柚子鹽拉麵', transModeIcon: 'walking', nextDist: '10 min' }
                ]);

                // 篩選當日行程
                const currentDayItinerary = computed({
                    get: () => itineraryData.value.filter(item => item.date === selectedDate.value),
                    set: (val) => {
                        // 拖曳結束後的處理
                        const otherDays = itineraryData.value.filter(item => item.date !== selectedDate.value);
                        itineraryData.value = [...otherDays, ...val];
                    }
                });

                // 資訊頁面資料
                const travelInfo = [
                    { title: '住宿資訊', icon: 'home', content: '星野集團 界 長門<br>+81 050-3134-8091<br>山口縣長門市深川湯本2229-1', address: 'Nagato, Yamaguchi' },
                    { title: '租車資訊', icon: 'car', content: 'Toyota Rent-a-car 成田機場店<br>預約編號: JP882910', address: 'Narita Airport' },
                    { title: '緊急醫療', icon: 'shield-alert', content: '警察: 110<br>救護車: 119<br>東京都外語諮詢: 03-5285-8181' }
                ];

                // 購物清單
                const shoppingList = ref([
                    { id: 1, name: 'SHIRO 香水', price: '¥ 4,500', img: 'https://images.unsplash.com/photo-1541643600914-78b084683601?w=400' },
                    { id: 2, name: 'Blue Bottle 咖啡豆', price: '¥ 1,800', img: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400' }
                ]);

                // 花費
                const expenses = ref([
                    { id: 1, category: '飲食', name: '阿夫利拉麵', date: '2026-02-15', amount: 1500, payment: '現金' },
                    { id: 2, category: '交通', name: 'Suica 加值', date: '2026-02-15', amount: 3000, payment: '信用卡' }
                ]);

                const totalExpenses = computed(() => expenses.value.reduce((sum, exp) => sum + exp.amount, 0));

                const getExpIcon = (cat) => {
                    const icons = { '飲食': 'utensils', '交通': 'train', '住宿': 'hotel', '購物': 'shopping-bag' };
                    return icons[cat] || 'tag';
                };

                const startNav = (addr) => {
                    if(!addr) return;
                    window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(addr)}`, '_blank');
                };

                const newItem = ref({ type: '景點', name: '', address: '', time: '', note: '' });

                const saveItem = () => {
                    const item = { ...newItem.value, id: Date.now(), date: selectedDate.value };
                    itineraryData.value.push(item);
                    showAddModal.value = false;
                    // 重置
                    newItem.value = { type: '景點', name: '', address: '', time: '', note: '' };
                    setTimeout(() => lucide.createIcons(), 100);
                };

                const confirmDelete = () => {
                    if(confirm("確定要刪除此行程嗎？")) {
                        // 刪除邏輯
                    }
                };

                onMounted(() => {
                    lucide.createIcons();
                });

                watchEffect(() => {
                    // 每當切換 Tab 或日期，重新渲染 Lucide Icons
                    if (currentTab.value || selectedDate.value) {
                        setTimeout(() => lucide.createIcons(), 10);
                    }
                });

                return {
                    currentTab, selectedDate, dates, itineraryData, currentDayItinerary,
                    travelInfo, shoppingList, expenses, totalExpenses, getExpIcon,
                    exJPY, startNav, showAddModal, newItem, saveItem, isEditing, confirmDelete
                };
            }
        }).mount('#app');
    </script>

    <style>
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .animate-slide-up { animation: slide-up 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</body>
</html>
